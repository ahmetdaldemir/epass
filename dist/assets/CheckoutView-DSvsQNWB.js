import{r as e,A as a,o as t,w as l,c as o,a as s,i as n,g as r,F as i,k as u,V as d,X as c,l as p,t as m,b as v,u as y,W as f,h}from"./vendor-D8r79KCq.js";import{u as g}from"./selectedTour-1xvN7VTI.js";import{_ as b}from"./index-4F1G0e-F.js";import"./swiper-WOzPqNul.js";var k,x="https://js.stripe.com",_="".concat(x,"/").concat("basil","/stripe.js"),w=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,S=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/,C=function(e){return w.test(e)||S.test(e)},P=function(e){var a=document.createElement("script");a.src="".concat(_).concat("");var t=document.head||document.body;if(!t)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return t.appendChild(a),a},j=null,q=null,T=null,U=function(e){return null!==j?j:(j=new Promise(function(a,t){if("undefined"!=typeof window&&"undefined"!=typeof document)if(window.Stripe)a(window.Stripe);else try{var l=function(){for(var e=document.querySelectorAll('script[src^="'.concat(x,'"]')),a=0;a<e.length;a++){var t=e[a];if(C(t.src))return t}return null}();if(l&&e);else if(l){if(l&&null!==T&&null!==q){var o;l.removeEventListener("load",T),l.removeEventListener("error",q),null===(o=l.parentNode)||void 0===o||o.removeChild(l),l=P()}}else l=P();T=function(e,a){return function(){window.Stripe?e(window.Stripe):a(new Error("Stripe.js not available"))}}(a,t),q=function(e){return function(a){e(new Error("Failed to load Stripe.js",{cause:a}))}}(t),l.addEventListener("load",T),l.addEventListener("error",q)}catch(s){return void t(s)}else a(null)})).catch(function(e){return j=null,Promise.reject(e)})};Promise.resolve().then(function(){return k||(k=U(null).catch(function(e){return k=null,Promise.reject(e)}))}).catch(function(e){});const E={class:"checkout-main-layout"},N={class:"checkout-left"},D={class:"form-group"},I={class:"form-group"},L={class:"form-group"},O=["value"],$={class:"form-group phone-row"},J={class:"phone-input-group"},R={class:"country-code-display"},V=["src","alt"],z=["placeholder"],A={class:"form-group"},B={class:"form-group"},F={style:{display:"flex",gap:"8px"}},M={key:0},G=["href"],Q={class:"form-group"},Y=["disabled"],H={key:0},K={key:1},X={key:0,class:"success-message"},W={key:1,class:"error-message"},Z={class:"checkout-right"},ee={key:0,class:"order-summary-panel"},ae={key:0,class:"order-summary-product"},te=["src","alt"],le={class:"order-summary-product-info"},oe={class:"product-title"},se={class:"product-detail"},ne={key:0,class:"product-detail"},re={class:"product-detail"},ie={key:1,class:"product-detail"},ue={key:2,class:"product-detail"},de=["href"],ce={key:1,class:"order-summary-product"},pe={class:"order-summary-product-info"},me={class:"product-title"},ve={class:"product-detail"},ye={key:0,class:"product-detail"},fe={class:"product-detail"},he={key:1,class:"product-detail"},ge={key:2,class:"product-detail"},be={class:"order-summary-total-row"},ke={class:"order-summary-total"},xe=b({__name:"CheckoutView",setup(b){var k,x;let _,w,S;const C=f(),P=g(),j=[{name:"Turkey",code:"+90",iso:"TR"},{name:"United States",code:"+1",iso:"US"},{name:"Germany",code:"+49",iso:"DE"},{name:"France",code:"+33",iso:"FR"},{name:"United Kingdom",code:"+44",iso:"GB"},{name:"Italy",code:"+39",iso:"IT"},{name:"Spain",code:"+34",iso:"ES"},{name:"Netherlands",code:"+31",iso:"NL"},{name:"Russia",code:"+7",iso:"RU"},{name:"Japan",code:"+81",iso:"JP"},{name:"China",code:"+86",iso:"CN"},{name:"India",code:"+91",iso:"IN"},{name:"Brazil",code:"+55",iso:"BR"},{name:"Canada",code:"+1",iso:"CA"},{name:"Australia",code:"+61",iso:"AU"}],q=e(j[0].name),T=e(""),U=a(()=>j.find(e=>e.name===q.value)||j[0]),xe=e(""),_e=e((null==(k=P.tour)?void 0:k.email)||(null==(x=P.pass)?void 0:x.email)||""),we=e(null);try{const e=localStorage.getItem("customerLogin");e&&(we.value=JSON.parse(e))}catch(Re){we.value=null}const Se=e(""),Ce=e(!1),Pe=e(!1),je=e(""),qe=e(1),Te=e(""),Ue=e(""),Ee=e(localStorage.getItem("selectedCurrency")||"EUR"),Ne=a(()=>({EUR:4,USD:5,GBP:6,TRY:7}[Ee.value]||4)),De=a(()=>({tr:2,de:6,en:1,ar:3,es:4,fr:5,it:7,pt:8,zh:10,ja:11,ru:9}[localStorage.getItem("selectedLanguage")||"en"]||1));function Ie(){S||(_=window.Stripe("pk_test_51RmaYhQQzUg4uq68XfoINf2CrffnJsjaJ1OHLwLtNLHHKcJ2uPlQABvQi5gFefQ5CnyJtbBbLOK7yioo2pPhkzfS00bUBXgBV7"),w=_.elements(),S=w.create("card",{style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"}},invalid:{color:"#9e2146"}}}),S.mount("#card-element"))}function Le(){navigator.geolocation?navigator.geolocation.getCurrentPosition(async e=>{const{latitude:a,longitude:t}=e.coords;try{const e=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${a}&lon=${t}`),l=await e.json();Ue.value=l.display_name||`${a}, ${t}`}catch(l){Ue.value=`${a}, ${t}`}},e=>{alert("Could not get your location")}):alert("Geolocation is not supported by your browser")}function Oe(e){if(/^-?\d+(\.\d+)?[, ]+\s*-?\d+(\.\d+)?$/.test(e)){const a=e.split(/[ ,]+/).map(Number);return`https://www.google.com/maps?q=${a[0]},${a[1]}`}return`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(e)}`}function $e(e){if(!e)return 0;const a=e.replace(/[^\d.,]/g,"").replace(",","."),t=parseFloat(a);return Math.round(100*t)}t(()=>{l(qe,e=>{2===e&&setTimeout(()=>{if(window.Stripe)Ie();else{const e=document.createElement("script");e.src="https://js.stripe.com/v3/",e.onload=Ie,document.head.appendChild(e)}},0)},{immediate:!0})});const Je=async()=>{var e,a,t,l,o,s,n,r,i,u,d,c,p,m,v,y,f,h,g,b,k,x;if(1===qe.value)return xe.value&&_e.value&&q.value&&T.value&&Te.value?void(qe.value=2):void(je.value="Please fill in all required fields.");Ce.value=!0,je.value="",Pe.value=!1;try{if(!_)throw new Error("Stripe not initialized. Please refresh the page.");const j=await fetch("https://backend.searchyourtour.com/api/submit-booking",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customer:{name:xe.value,email:_e.value,phone:U.value.code+T.value,country:q.value,hotel_address:Te.value,user_location:Ue.value},...P.tour?{tour:{id:(null==(e=P.tour)?void 0:e.id)||null,title:(null==(a=P.tour)?void 0:a.title)||"",description:(null==(t=P.tour)?void 0:t.description)||"",price:(null==(l=P.tour)?void 0:l.price)||"",booking_date:(null==(o=P.tour)?void 0:o.bookingDate)||(new Date).toISOString().split("T")[0],tenant_id:"ad5257a5-efdd-4314-9e5e-b56aabe321f1",currency_id:Ne.value,language_id:De.value,buggy:0,adult:(null==(s=P.tour)?void 0:s.adult)||1,child:(null==(n=P.tour)?void 0:n.child)||0,infant:(null==(r=P.tour)?void 0:r.infant)||0,roomNumber:0,randomCode:Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),type:"tour",customer_id:(null==(i=we.value)?void 0:i.id)||0}}:{pass:{id:(null==(u=P.pass)?void 0:u.id)||null,name:(null==(d=P.pass)?void 0:d.name)||"",days:(null==(c=P.pass)?void 0:c.days)||1,price:(null==(p=P.pass)?void 0:p.price)||"",total_price:(null==(m=P.pass)?void 0:m.totalPrice)||"",quantity:(null==(v=P.pass)?void 0:v.quantity)||1,start_date:(null==(y=P.pass)?void 0:y.startDate)||(new Date).toISOString().split("T")[0],email:(null==(f=P.pass)?void 0:f.email)||"",tenant_id:"ad5257a5-efdd-4314-9e5e-b56aabe321f1",currency_id:Ne.value,language_id:De.value,randomCode:Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),type:"pass"}},payment:{amount:$e((null==(h=P.tour)?void 0:h.price)||(null==(g=P.pass)?void 0:g.totalPrice)||""),currency:Ee.value}})}),E=await j.json();if(null==E?void 0:E.client_secret){const e=await _.confirmCardPayment(E.client_secret,{payment_method:{card:S,billing_details:{name:xe.value,email:_e.value,phone:U.value.code+T.value,address:{country:U.value.iso,line1:Te.value}}},return_url:"https://yourfrontend.com/payment-status"});try{const a=E.payment_intent_id;e.error?(je.value=e.error.message||"Payment failed. Please try again.",E.reservation_id&&a&&await fetch("https://backend.searchyourtour.com/api/check_payment_status",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reservation_id:E.reservation_id,randomCode:E.randomCode,payment_intent_id:a})})):"succeeded"===e.paymentIntent.status?(Pe.value=!0,E.reservation_id&&a&&await fetch("https://backend.searchyourtour.com/api/check_payment_status",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reservation_id:E.reservation_id,randomCode:E.randomCode,payment_intent_id:a})}),C.push({name:"payment-success",query:{bookingId:E.reservation_id,tourTitle:(null==(b=P.tour)?void 0:b.title)||"",bookingDate:(null==(k=P.tour)?void 0:k.bookingDate)||"",amount:(null==(x=P.tour)?void 0:x.price)||"",customerName:xe.value||""}})):(je.value="Ödeme işlemi tamamlanmadı, ek onay gerekebilir.",E.reservation_id&&a&&await fetch("https://backend.searchyourtour.com/api/check_payment_status",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reservation_id:E.reservation_id,randomCode:E.randomCode,payment_intent_id:a})}))}catch(w){je.value=w.message||"Payment failed. Please try again."}finally{Ce.value=!1}}}catch(w){je.value=w.message||"Payment failed. Please try again."}finally{Ce.value=!1}};return(e,a)=>{var t,l;return h(),o("div",E,[s("div",N,[a[19]||(a[19]=s("h2",null,"Enter your personal details",-1)),a[20]||(a[20]=s("div",{class:"secure-checkout"},[s("i",{class:"fas fa-lock"}),n(" Checkout is fast and secure ")],-1)),s("form",{onSubmit:r(Je,["prevent"]),class:"checkout-form"},[1===qe.value?(h(),o(i,{key:0},[s("div",D,[a[7]||(a[7]=s("label",null,[n("Full name "),s("span",{class:"required"},"*")],-1)),u(s("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>xe.value=e),type:"text",required:"",placeholder:"Full Name"},null,512),[[d,xe.value]])]),s("div",I,[a[8]||(a[8]=s("label",null,[n("Email "),s("span",{class:"required"},"*")],-1)),u(s("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>_e.value=e),type:"email",required:"",placeholder:"you@email.com"},null,512),[[d,_e.value]])]),s("div",L,[a[9]||(a[9]=s("label",null,[n("Country "),s("span",{class:"required"},"*")],-1)),u(s("select",{"onUpdate:modelValue":a[2]||(a[2]=e=>q.value=e),class:"country-select-fullwidth"},[(h(),o(i,null,p(j,e=>s("option",{key:e.iso,value:e.name},m(e.name),9,O)),64))],512),[[c,q.value]])]),s("div",$,[a[10]||(a[10]=s("label",null,[n("Mobile phone number "),s("span",{class:"required"},"*")],-1)),s("div",J,[s("div",R,[s("img",{src:`https://flagsapi.com/${U.value.iso}/flat/24.png`,alt:U.value.name,class:"flag-option"},null,8,V),s("span",null,m(U.value.code),1)]),u(s("input",{"onUpdate:modelValue":a[3]||(a[3]=e=>T.value=e),type:"tel",required:"",class:"phone-input",placeholder:"TR"===U.value.iso?"5xx xxx xx xx":"US"===U.value.iso?"xxx xxx xxxx":"DE"===U.value.iso?"1xx xxxxxxx":"xx xx xx xx"},null,8,z),[[d,T.value]])])]),s("div",A,[a[11]||(a[11]=s("label",null,[n("Hotel Address "),s("span",{class:"required"},"*")],-1)),u(s("input",{"onUpdate:modelValue":a[4]||(a[4]=e=>Te.value=e),type:"text",required:"",placeholder:"Enter your hotel address"},null,512),[[d,Te.value]])]),s("div",B,[a[12]||(a[12]=s("label",null,"Your Location (optional)",-1)),s("div",F,[u(s("input",{"onUpdate:modelValue":a[5]||(a[5]=e=>Ue.value=e),type:"text",placeholder:"Click the button to add your current location",readonly:"",class:"input",style:{flex:"1"}},null,512),[[d,Ue.value]]),s("button",{type:"button",onClick:Le,class:"location-btn",title:"Use my location"},"📍")]),Ue.value?(h(),o("div",M,[s("a",{href:Oe(Ue.value),target:"_blank",rel:"noopener",style:{color:"#0070eb","text-decoration":"underline",cursor:"pointer","font-size":"0.97em"}}," View on Google Maps ",8,G)])):v("",!0)]),a[13]||(a[13]=s("div",{class:"form-note"},"We’ll only contact you with essential updates or changes to your booking",-1)),a[14]||(a[14]=s("button",{class:"pay-btn",type:"submit"},"Go to payment",-1))],64)):(h(),o(i,{key:1},[s("div",Q,[a[15]||(a[15]=s("label",null,[n("Name on Card "),s("span",{class:"required"},"*")],-1)),u(s("input",{"onUpdate:modelValue":a[6]||(a[6]=e=>Se.value=e),type:"text",required:"",placeholder:"Name on Card"},null,512),[[d,Se.value]])]),a[18]||(a[18]=s("div",{class:"form-group"},[s("label",null,"Card Details"),s("div",{id:"card-element",class:"stripe-card-element"})],-1)),s("button",{class:"pay-btn",disabled:Ce.value,type:"submit"},[Ce.value?(h(),o("span",H,"Processing...")):(h(),o("span",K,"Pay Now"))],8,Y),Pe.value?(h(),o("div",X,a[16]||(a[16]=[s("i",{class:"fas fa-check-circle"},null,-1),s("div",null,[s("strong",null,"Payment Successful!"),s("p",null,"Your booking has been confirmed. You will receive a confirmation email shortly.")],-1)]))):v("",!0),je.value?(h(),o("div",W,[a[17]||(a[17]=s("i",{class:"fas fa-exclamation-circle"},null,-1)),n(" "+m(je.value),1)])):v("",!0)],64))],32)]),s("div",Z,[y(P).tour||y(P).pass?(h(),o("div",ee,[a[31]||(a[31]=s("div",{class:"order-summary-title"},"Order summary",-1)),y(P).tour?(h(),o("div",ae,[s("img",{class:"order-summary-img",src:y(P).tour.image,alt:y(P).tour.title},null,8,te),s("div",le,[s("div",oe,m(y(P).tour.title),1),s("div",se,m(y(P).tour.description),1),y(P).tour.bookingDate?(h(),o("div",ne,[a[21]||(a[21]=s("i",{class:"fas fa-calendar-alt"},null,-1)),n(" "+m(y(P).tour.bookingDate),1)])):v("",!0),s("div",re,[a[22]||(a[22]=s("i",{class:"fas fa-user"},null,-1)),n(" "+m(y(P).tour.participants),1)]),y(P).tour.email?(h(),o("div",ie,[a[23]||(a[23]=s("i",{class:"fas fa-envelope"},null,-1)),n(" "+m(y(P).tour.email),1)])):v("",!0),y(P).tour.userLocation?(h(),o("div",ue,[a[24]||(a[24]=s("i",{class:"fas fa-map-marker-alt"},null,-1)),s("a",{href:Oe(y(P).tour.userLocation),target:"_blank",rel:"noopener",style:{color:"#0070eb","text-decoration":"underline",cursor:"pointer"}},m(y(P).tour.userLocation),9,de)])):v("",!0)])])):v("",!0),y(P).pass?(h(),o("div",ce,[a[29]||(a[29]=s("div",{class:"pass-icon"},[s("i",{class:"fas fa-ticket-alt"})],-1)),s("div",pe,[s("div",me,m(y(P).pass.name),1),s("div",ve,m(y(P).pass.days)+" Day Istanbul Tourist Pass",1),y(P).pass.startDate?(h(),o("div",ye,[a[25]||(a[25]=s("i",{class:"fas fa-calendar-alt"},null,-1)),n(" Start Date: "+m(y(P).pass.startDate),1)])):v("",!0),s("div",fe,[a[26]||(a[26]=s("i",{class:"fas fa-user"},null,-1)),n(" Quantity: "+m(y(P).pass.quantity),1)]),y(P).pass.email?(h(),o("div",he,[a[27]||(a[27]=s("i",{class:"fas fa-envelope"},null,-1)),n(" "+m(y(P).pass.email),1)])):v("",!0),y(P).pass.discount?(h(),o("div",ge,[a[28]||(a[28]=s("i",{class:"fas fa-tag"},null,-1)),n(" Save "+m(y(P).pass.discount)+"€ ",1)])):v("",!0)])])):v("",!0),s("div",be,[a[30]||(a[30]=s("span",null,"Total",-1)),s("span",ke,m((null==(t=y(P).tour)?void 0:t.price)||(null==(l=y(P).pass)?void 0:l.totalPrice)),1)]),a[32]||(a[32]=s("div",{class:"order-summary-taxes"},"All taxes and fees included",-1))])):v("",!0)])])}}},[["__scopeId","data-v-e379c1d8"]]);export{xe as default};
