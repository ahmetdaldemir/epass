import{_ as se,r as p,c as $,g as le,h as ie,a as d,b as t,f as m,m as ue,F as A,w as S,v as x,p as de,e as ce,t as v,d as b,u,am as pe,o as c}from"./index-7ALJyXWv.js";import{u as me}from"./selectedTour-DI3M4VSW.js";var ve="basil",ee="https://js.stripe.com",fe="".concat(ee,"/").concat(ve,"/stripe.js"),ye=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,ge=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/;var he=function(n){return ye.test(n)||ge.test(n)},_e=function(){for(var n=document.querySelectorAll('script[src^="'.concat(ee,'"]')),s=0;s<n.length;s++){var l=n[s];if(he(l.src))return l}return null},Z=function(n){var s="",l=document.createElement("script");l.src="".concat(fe).concat(s);var o=document.head||document.body;if(!o)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return o.appendChild(l),l},R=null,V=null,J=null,Se=function(n){return function(s){n(new Error("Failed to load Stripe.js",{cause:s}))}},be=function(n,s){return function(){window.Stripe?n(window.Stripe):s(new Error("Stripe.js not available"))}},xe=function(n){return R!==null?R:(R=new Promise(function(s,l){if(typeof window>"u"||typeof document>"u"){s(null);return}if(window.Stripe){s(window.Stripe);return}try{var o=_e();if(!(o&&n)){if(!o)o=Z(n);else if(o&&J!==null&&V!==null){var w;o.removeEventListener("load",J),o.removeEventListener("error",V),(w=o.parentNode)===null||w===void 0||w.removeChild(o),o=Z(n)}}J=be(s,l),V=Se(l),o.addEventListener("load",J),o.addEventListener("error",V)}catch(O){l(O);return}}),R.catch(function(s){return R=null,Promise.reject(s)}))},U,we=function(){return U||(U=xe(null).catch(function(n){return U=null,Promise.reject(n)}),U)};Promise.resolve().then(function(){return we()}).catch(function(f){console.warn(f)});const ke={class:"checkout-main-layout"},Ce={class:"checkout-left"},Pe={class:"form-group"},Ee={class:"form-group"},Le={class:"form-group"},Te=["value"],Re={class:"form-group phone-row"},Ue={class:"phone-input-group"},Ie={class:"country-code-display"},Ne=["src","alt"],je=["placeholder"],qe={class:"form-group"},Me={class:"form-group"},Ve={style:{display:"flex",gap:"8px"}},Je={key:0},Oe=["href"],Be={class:"form-group"},Ge=["disabled"],$e={key:0},Ae={key:1},De={key:0,class:"success-message"},Fe={key:1,class:"error-message"},ze={class:"checkout-right"},Qe={key:0,class:"order-summary-panel"},Xe={class:"order-summary-product"},Ye=["src","alt"],He={class:"order-summary-product-info"},Ke={class:"product-title"},We={class:"product-detail"},Ze={key:0,class:"product-detail"},et={class:"product-detail"},tt={key:1,class:"product-detail"},ot={key:2,class:"product-detail"},rt=["href"],nt={class:"order-summary-total-row"},at={class:"order-summary-total"},st={__name:"CheckoutView",setup(f){var X;let n,s,l;pe();const o=me(),w=a=>({tr:2,de:6,en:1,ar:3,es:4,fr:5,it:7,pt:8,zh:10,ja:11,ru:9})[a]||1,O=a=>({EUR:4,USD:5,GBP:6,TRY:7})[a]||4,I=[{name:"Turkey",code:"+90",iso:"TR"},{name:"United States",code:"+1",iso:"US"},{name:"Germany",code:"+49",iso:"DE"},{name:"France",code:"+33",iso:"FR"},{name:"United Kingdom",code:"+44",iso:"GB"},{name:"Italy",code:"+39",iso:"IT"},{name:"Spain",code:"+34",iso:"ES"},{name:"Netherlands",code:"+31",iso:"NL"},{name:"Russia",code:"+7",iso:"RU"},{name:"Japan",code:"+81",iso:"JP"},{name:"China",code:"+86",iso:"CN"},{name:"India",code:"+91",iso:"IN"},{name:"Brazil",code:"+55",iso:"BR"},{name:"Canada",code:"+1",iso:"CA"},{name:"Australia",code:"+61",iso:"AU"}],k=p(I[0].name),C=p(""),y=$(()=>I.find(a=>a.name===k.value)||I[0]),P=p(""),E=p(((X=o.tour)==null?void 0:X.email)||"");console.log("Selected Tour Store:",o.tour);const D=p(""),L=p(!1),B=p(!1),h=p(""),N=p(1),T=p(""),_=p(""),F=p(localStorage.getItem("selectedCurrency")||"EUR"),te=$(()=>O(F.value)),oe=$(()=>w(localStorage.getItem("selectedLanguage")||"en"));le(()=>{ie(N,a=>{a===2&&setTimeout(()=>{if(window.Stripe)z();else{const e=document.createElement("script");e.src="https://js.stripe.com/v3/",e.onload=z,document.head.appendChild(e)}},0)},{immediate:!0})});function z(){l||(n=window.Stripe("pk_test_51RmaYhQQzUg4uq68XfoINf2CrffnJsjaJ1OHLwLtNLHHKcJ2uPlQABvQi5gFefQ5CnyJtbBbLOK7yioo2pPhkzfS00bUBXgBV7"),s=n.elements(),l=s.create("card",{style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"}},invalid:{color:"#9e2146"}}}),l.mount("#card-element"))}function re(){if(!navigator.geolocation){alert("Geolocation is not supported by your browser");return}navigator.geolocation.getCurrentPosition(async a=>{const{latitude:e,longitude:r}=a.coords;try{const q=await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${r}`)).json();_.value=q.display_name||`${e}, ${r}`}catch{_.value=`${e}, ${r}`}},a=>{alert("Could not get your location")})}function Q(a){if(/^-?\d+(\.\d+)?[, ]+\s*-?\d+(\.\d+)?$/.test(a)){const e=a.split(/[ ,]+/).map(Number);return`https://www.google.com/maps?q=${e[0]},${e[1]}`}return`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(a)}`}function ne(a){if(!a)return 0;const e=a.replace(/[^\d.,]/g,"").replace(",","."),r=parseFloat(e);return Math.round(r*100)}const ae=async()=>{var a,e,r,j,q,Y,H,K,W;if(N.value===1){if(!P.value||!E.value||!k.value||!C.value||!T.value){h.value="Please fill in all required fields.";return}N.value=2;return}L.value=!0,h.value="",B.value=!1;try{if(!n)throw new Error("Stripe not initialized. Please refresh the page.");const i=await(await fetch("https://searchyourtour.com/api/submit-booking",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customer:{name:P.value,email:E.value,phone:y.value.code+C.value,country:k.value,hotel_address:T.value,user_location:_.value},tour:{id:((a=o.tour)==null?void 0:a.id)||null,title:((e=o.tour)==null?void 0:e.title)||"",description:((r=o.tour)==null?void 0:r.description)||"",price:((j=o.tour)==null?void 0:j.price)||"",booking_date:((q=o.tour)==null?void 0:q.bookingDate)||new Date().toISOString().split("T")[0],tenant_id:"ad5257a5-efdd-4314-9e5e-b56aabe321f1",currency_id:te.value,language_id:oe.value,buggy:0,adult:((Y=o.tour)==null?void 0:Y.adult)||1,child:((H=o.tour)==null?void 0:H.child)||0,infant:((K=o.tour)==null?void 0:K.infant)||0,roomNumber:0,randomCode:Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},payment:{amount:ne(((W=o.tour)==null?void 0:W.price)||""),currency:F.value}})})).json();if(i!=null&&i.client_secret){const M=await n.confirmCardPayment(i.client_secret,{payment_method:{card:l,billing_details:{name:P.value,email:E.value,phone:y.value.code+C.value,address:{country:y.value.iso,line1:T.value}}},return_url:"https://yourfrontend.com/payment-status"});try{const g=i.payment_intent_id;M.error?(console.error("Ödeme hatası:",M.error.message),h.value=M.error.message||"Payment failed. Please try again.",i.reservation_id&&g&&await fetch("https://searchyourtour.com/api/check_payment_status",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reservation_id:i.reservation_id,randomCode:i.randomCode,payment_intent_id:g})})):M.paymentIntent.status==="succeeded"?(B.value=!0,i.reservation_id&&g&&await fetch("https://searchyourtour.com/api/check_payment_status",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reservation_id:i.reservation_id,randomCode:i.randomCode,payment_intent_id:g})})):(h.value="Ödeme işlemi tamamlanmadı, ek onay gerekebilir.",i.reservation_id&&g&&await fetch("https://searchyourtour.com/api/check_payment_status",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reservation_id:i.reservation_id,randomCode:i.randomCode,payment_intent_id:g})}))}catch(g){console.error("Payment error:",g),h.value=g.message||"Payment failed. Please try again."}finally{L.value=!1}}}catch(G){console.error("Payment error:",G),h.value=G.message||"Payment failed. Please try again."}finally{L.value=!1}};return(a,e)=>(c(),d("div",ke,[t("div",Ce,[e[19]||(e[19]=t("h2",null,"Enter your personal details",-1)),e[20]||(e[20]=t("div",{class:"secure-checkout"},[t("i",{class:"fas fa-lock"}),m(" Checkout is fast and secure ")],-1)),t("form",{onSubmit:ue(ae,["prevent"]),class:"checkout-form"},[N.value===1?(c(),d(A,{key:0},[t("div",Pe,[e[7]||(e[7]=t("label",null,[m("Full name "),t("span",{class:"required"},"*")],-1)),S(t("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>P.value=r),type:"text",required:"",placeholder:"Full Name"},null,512),[[x,P.value]])]),t("div",Ee,[e[8]||(e[8]=t("label",null,[m("Email "),t("span",{class:"required"},"*")],-1)),S(t("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>E.value=r),type:"email",required:"",placeholder:"you@email.com"},null,512),[[x,E.value]])]),t("div",Le,[e[9]||(e[9]=t("label",null,[m("Country "),t("span",{class:"required"},"*")],-1)),S(t("select",{"onUpdate:modelValue":e[2]||(e[2]=r=>k.value=r),class:"country-select-fullwidth"},[(c(),d(A,null,ce(I,r=>t("option",{key:r.iso,value:r.name},v(r.name),9,Te)),64))],512),[[de,k.value]])]),t("div",Re,[e[10]||(e[10]=t("label",null,[m("Mobile phone number "),t("span",{class:"required"},"*")],-1)),t("div",Ue,[t("div",Ie,[t("img",{src:`https://flagsapi.com/${y.value.iso}/flat/24.png`,alt:y.value.name,class:"flag-option"},null,8,Ne),t("span",null,v(y.value.code),1)]),S(t("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>C.value=r),type:"tel",required:"",class:"phone-input",placeholder:y.value.iso==="TR"?"5xx xxx xx xx":y.value.iso==="US"?"xxx xxx xxxx":y.value.iso==="DE"?"1xx xxxxxxx":"xx xx xx xx"},null,8,je),[[x,C.value]])])]),t("div",qe,[e[11]||(e[11]=t("label",null,[m("Hotel Address "),t("span",{class:"required"},"*")],-1)),S(t("input",{"onUpdate:modelValue":e[4]||(e[4]=r=>T.value=r),type:"text",required:"",placeholder:"Enter your hotel address"},null,512),[[x,T.value]])]),t("div",Me,[e[12]||(e[12]=t("label",null,"Your Location (optional)",-1)),t("div",Ve,[S(t("input",{"onUpdate:modelValue":e[5]||(e[5]=r=>_.value=r),type:"text",placeholder:"Click the button to add your current location",readonly:"",class:"input",style:{flex:"1"}},null,512),[[x,_.value]]),t("button",{type:"button",onClick:re,class:"location-btn",title:"Use my location"},"📍")]),_.value?(c(),d("div",Je,[t("a",{href:Q(_.value),target:"_blank",rel:"noopener",style:{color:"#0070eb","text-decoration":"underline",cursor:"pointer","font-size":"0.97em"}}," View on Google Maps ",8,Oe)])):b("",!0)]),e[13]||(e[13]=t("div",{class:"form-note"},"We’ll only contact you with essential updates or changes to your booking",-1)),e[14]||(e[14]=t("button",{class:"pay-btn",type:"submit"},"Go to payment",-1))],64)):(c(),d(A,{key:1},[t("div",Be,[e[15]||(e[15]=t("label",null,[m("Name on Card "),t("span",{class:"required"},"*")],-1)),S(t("input",{"onUpdate:modelValue":e[6]||(e[6]=r=>D.value=r),type:"text",required:"",placeholder:"Name on Card"},null,512),[[x,D.value]])]),e[18]||(e[18]=t("div",{class:"form-group"},[t("label",null,"Card Details"),t("div",{id:"card-element",class:"stripe-card-element"})],-1)),t("button",{class:"pay-btn",disabled:L.value,type:"submit"},[L.value?(c(),d("span",$e,"Processing...")):(c(),d("span",Ae,"Pay Now"))],8,Ge),B.value?(c(),d("div",De,e[16]||(e[16]=[t("i",{class:"fas fa-check-circle"},null,-1),t("div",null,[t("strong",null,"Payment Successful!"),t("p",null,"Your booking has been confirmed. You will receive a confirmation email shortly.")],-1)]))):b("",!0),h.value?(c(),d("div",Fe,[e[17]||(e[17]=t("i",{class:"fas fa-exclamation-circle"},null,-1)),m(" "+v(h.value),1)])):b("",!0)],64))],32)]),t("div",ze,[u(o).tour?(c(),d("div",Qe,[e[26]||(e[26]=t("div",{class:"order-summary-title"},"Order summary",-1)),t("div",Xe,[t("img",{class:"order-summary-img",src:u(o).tour.image,alt:u(o).tour.title},null,8,Ye),t("div",He,[t("div",Ke,v(u(o).tour.title),1),t("div",We,v(u(o).tour.description),1),u(o).tour.bookingDate?(c(),d("div",Ze,[e[21]||(e[21]=t("i",{class:"fas fa-calendar-alt"},null,-1)),m(" "+v(u(o).tour.bookingDate),1)])):b("",!0),t("div",et,[e[22]||(e[22]=t("i",{class:"fas fa-user"},null,-1)),m(" "+v(u(o).tour.participants),1)]),u(o).tour.email?(c(),d("div",tt,[e[23]||(e[23]=t("i",{class:"fas fa-envelope"},null,-1)),m(" "+v(u(o).tour.email),1)])):b("",!0),u(o).tour.userLocation?(c(),d("div",ot,[e[24]||(e[24]=t("i",{class:"fas fa-map-marker-alt"},null,-1)),t("a",{href:Q(u(o).tour.userLocation),target:"_blank",rel:"noopener",style:{color:"#0070eb","text-decoration":"underline",cursor:"pointer"}},v(u(o).tour.userLocation),9,rt)])):b("",!0)])]),t("div",nt,[e[25]||(e[25]=t("span",null,"Total",-1)),t("span",at,v(u(o).tour.price),1)]),e[27]||(e[27]=t("div",{class:"order-summary-taxes"},"All taxes and fees included",-1))])):b("",!0)])]))}},ut=se(st,[["__scopeId","data-v-f6fea19e"]]);export{ut as default};
