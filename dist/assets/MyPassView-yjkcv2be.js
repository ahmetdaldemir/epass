import{r as e,o as a,c as s,a as t,b as l,g as o,k as n,V as i,t as r,n as u,i as c,F as d,l as p,h as v}from"./vendor-D8r79KCq.js";import{_ as m}from"./index-dZArVhS9.js";import"./swiper-WOzPqNul.js";const y={class:"my-pass-panel"},h={key:0,class:"login-outer"},f={class:"login-box"},g={class:"forgot-password"},b={key:0,class:"error"},w={class:"modal-header"},C={class:"form-group"},P=["disabled"],N={key:1,class:"dashboard-container"},k={class:"side-menu"},S={class:"user-profile"},U={class:"user-avatar"},j={class:"user-info"},A={class:"nav-menu"},q={class:"main-content"},_={key:0,class:"content-section"},I={class:"reservation-list"},R={class:"reservation-header"},E={class:"reservation-details"},T={class:"detail-row"},L={class:"detail-item"},V={class:"detail-value"},X={class:"detail-item"},$={class:"detail-value"},M={class:"detail-row"},O={class:"detail-item"},x={class:"detail-value price"},J={class:"detail-item"},F={class:"detail-value"},W={class:"reservation-actions"},z=["onClick"],H=["onClick","disabled"],D={key:0,class:"empty-state"},B={key:1,class:"content-section"},G={class:"form-section"},Z={class:"form-row"},Y={class:"form-group"},K={class:"form-group"},Q={class:"form-section"},ee={class:"form-group"},ae={class:"form-group"},se={class:"form-section"},te={class:"form-group"},le={class:"form-row"},oe={class:"form-group"},ne={class:"form-group"},ie={class:"form-group"},re={key:2,class:"content-section"},ue={class:"form-group"},ce={class:"form-group"},de={class:"form-group"},pe=m({__name:"MyPassView",setup(m){const pe=e(!1),ve=e(""),me=e(""),ye=e(""),he=e("reservations"),fe=e([]),ge=e({firstName:"",lastName:"",email:"",phone:"",address:"",city:"",country:"",zip_code:""}),be=e(""),we=e(""),Ce=e(""),Pe=e(""),Ne=e(!1),ke=e(!1),Se=e(""),Ue=e(!1),je=e(""),Ae=e(!1);async function qe(e){try{const a=await fetch(`https://searchyourtour.com/api/customer/reservations/${e}`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}),s=await a.json();s.status&&(fe.value=s.data||[])}catch(a){}}async function _e(){try{ye.value="";const e=await fetch("https://searchyourtour.com/api/login",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({email:ve.value,password:me.value})}),a=await e.json();a.status?(pe.value=!0,ye.value="",localStorage.setItem("user",JSON.stringify(a.data)),localStorage.setItem("isLoggedIn","true"),ve.value="",me.value=""):ye.value="Invalid email or password"}catch(e){ye.value="An error occurred during login. Please try again."}}function Ie(){pe.value=!1,localStorage.removeItem("user"),localStorage.removeItem("isLoggedIn")}function Re(e){confirm("Are you sure you want to cancel this reservation?")&&async function(e){try{const a=await fetch(`https://searchyourtour.com/api/customer/reservations/cancel/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}),s=await a.json();if(s.status){alert("Reservation cancelled successfully!");const e=localStorage.getItem("user");if(e){const a=JSON.parse(e);await qe(a.id)}}else alert("Failed to cancel reservation: "+(s.message||"Unknown error"))}catch(a){alert("An error occurred while cancelling reservation. Please try again.")}}(e.id)}async function Ee(){try{const e=localStorage.getItem("user");if(!e)return void alert("User not found. Please login again.");const a=JSON.parse(e),s=await fetch(`https://searchyourtour.com/api/customer/profile/update/${a.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({fullname:`${ge.value.firstName} ${ge.value.lastName}`.trim(),email:ge.value.email,phone:ge.value.phone,address:ge.value.address,city:ge.value.city,country:ge.value.country,zip_code:ge.value.zip_code})}),t=await s.json();t.status?alert("Profile updated successfully!"):alert("Failed to update profile: "+(t.message||"Unknown error"))}catch(e){alert("An error occurred while updating profile. Please try again.")}}async function Te(){try{if(Pe.value="",Ne.value=!1,we.value.length<6)return Pe.value="New password must be at least 6 characters.",void(Ne.value=!1);if(we.value!==Ce.value)return Pe.value="New passwords do not match.",void(Ne.value=!1);const e=localStorage.getItem("user");if(!e)return Pe.value="User not found. Please login again.",void(Ne.value=!1);const a=JSON.parse(e),s=await fetch(`https://searchyourtour.com/api/customer/change-password/${a.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({current_password:be.value,new_password:we.value,new_password_confirmation:Ce.value})}),t=await s.json();t.status?(Pe.value="Password changed successfully!",Ne.value=!0,be.value="",we.value="",Ce.value=""):(Pe.value=t.message||"Failed to change password",Ne.value=!1)}catch(e){Pe.value="An error occurred while changing password. Please try again.",Ne.value=!1}}function Le(e){if(!e)return"N/A";return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}function Ve(e){const a=[];return e.adult>0&&a.push(`Adults: ${e.adult}`),e.child>0&&a.push(`Children: ${e.child}`),e.infant>0&&a.push(`Infants: ${e.infant}`),e.buggy>0&&a.push(`Buggy: ${e.buggy}`),a.length>0?a.join(", "):"No attendees"}function Xe(e){if(!e)return!0;return["pending","waiting","approved","paid","Pending","Waiting","Approved","Paid"].includes(e)}function $e(){const e=ge.value.firstName||"",a=ge.value.lastName||"";return(e.charAt(0)+a.charAt(0)).toUpperCase()||"U"}async function Me(){try{Ue.value=!0,je.value="",Ae.value=!1;const e=await fetch("https://searchyourtour.com/api/customer/password/email",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({email:Se.value})}),a=await e.json();a.status?(Ae.value=!0,je.value=a.message||"Password reset link sent successfully!",Se.value="",setTimeout(()=>{ke.value=!1,je.value=""},3e3)):(Ae.value=!1,je.value=a.message||"Failed to send reset link")}catch(e){Ae.value=!1,je.value="An error occurred. Please try again."}finally{Ue.value=!1}}return a(async()=>{const e=localStorage.getItem("isLoggedIn"),a=localStorage.getItem("user");if("true"===e&&a){pe.value=!0;try{const e=JSON.parse(a);await async function(e){try{const a=await fetch(`https://searchyourtour.com/api/customer/profile/${e}`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}),s=await a.json();if(s.status){const e=(s.data.fullname||"").split(" ");ge.value={firstName:e[0]||"",lastName:e.slice(1).join(" ")||"",email:s.data.email||"",phone:s.data.phone||"",address:s.data.address||"",city:s.data.city||"",country:s.data.country||"",zip_code:s.data.zip_code||""}}}catch(a){}}(e.id),await qe(e.id)}catch(s){}}}),(e,a)=>(v(),s("div",y,[pe.value?(v(),s("div",N,[t("aside",k,[t("div",S,[t("div",U,[t("span",null,r($e()),1)]),t("div",j,[t("h3",null,r(((ge.value.firstName||"")+" "+(ge.value.lastName||"")).trim()||"User"),1),a[27]||(a[27]=t("p",null,"Account",-1))])]),t("nav",A,[t("div",{class:u(["nav-item",{active:"reservations"===he.value}]),onClick:a[8]||(a[8]=e=>he.value="reservations")},a[28]||(a[28]=[t("i",{class:"nav-icon"},"📋",-1),t("span",null,"My Reservations",-1)]),2),t("div",{class:u(["nav-item",{active:"info"===he.value}]),onClick:a[9]||(a[9]=e=>he.value="info")},a[29]||(a[29]=[t("i",{class:"nav-icon"},"👤",-1),t("span",null,"Profile",-1)]),2),t("div",{class:u(["nav-item",{active:"password"===he.value}]),onClick:a[10]||(a[10]=e=>he.value="password")},a[30]||(a[30]=[t("i",{class:"nav-icon"},"🔒",-1),t("span",null,"Change Password",-1)]),2)]),t("button",{class:"logout-btn",onClick:Ie},a[31]||(a[31]=[t("i",{class:"logout-icon"},"🚪",-1),c(" Logout ")]))]),t("main",q,["reservations"===he.value?(v(),s("section",_,[a[45]||(a[45]=t("div",{class:"section-header"},[t("h2",null,"My Reservations"),t("p",{class:"section-subtitle"},"Manage your tour bookings")],-1)),t("div",I,[(v(!0),s(d,null,p(fe.value,e=>{return v(),s("div",{class:"reservation-card",key:e.id},[t("div",R,[t("h3",null,r(e.tourName),1),t("span",{class:u(["status-badge",e.payment_status])},r((l=e.payment_status,l.charAt(0).toUpperCase()+l.slice(1))),3)]),t("div",E,[t("div",T,[t("div",L,[a[32]||(a[32]=t("i",{class:"detail-icon"},"📅",-1)),a[33]||(a[33]=t("span",{class:"detail-label"},"Date:",-1)),t("span",V,r(Le(e.tour_date)),1)]),t("div",X,[a[34]||(a[34]=t("i",{class:"detail-icon"},"⏰",-1)),a[35]||(a[35]=t("span",{class:"detail-label"},"Time:",-1)),t("span",$,r(e.tour_time||"TBD"),1)])]),t("div",M,[t("div",O,[a[36]||(a[36]=t("i",{class:"detail-icon"},"💰",-1)),a[37]||(a[37]=t("span",{class:"detail-label"},"Total:",-1)),t("span",x,r(e.total)+" "+r(e.totalCurrency),1)]),t("div",J,[a[38]||(a[38]=t("i",{class:"detail-icon"},"👥",-1)),a[39]||(a[39]=t("span",{class:"detail-label"},"Attendees:",-1)),t("span",F,r(Ve(e)),1)])])]),t("div",W,[t("button",{class:"btn btn-edit",onClick:a=>function(e){alert("Edit reservation: "+e.id)}(e)},a[40]||(a[40]=[t("i",{class:"btn-icon"},"✏️",-1),c(" Edit ")]),8,z),t("button",{class:"btn btn-cancel",onClick:a=>Re(e),disabled:!Xe(e.payment_status)},a[41]||(a[41]=[t("i",{class:"btn-icon"},"❌",-1),c(" Cancel ")]),8,H)])]);var l}),128)),0===fe.value.length?(v(),s("div",D,[a[42]||(a[42]=t("div",{class:"empty-icon"},"📋",-1)),a[43]||(a[43]=t("h3",null,"No Reservations Found",-1)),a[44]||(a[44]=t("p",null,"You haven't made any reservations yet.",-1)),t("button",{class:"btn btn-primary",onClick:a[11]||(a[11]=a=>e.$router.push("/tours"))},"Browse Tours")])):l("",!0)])])):l("",!0),"info"===he.value?(v(),s("section",B,[a[59]||(a[59]=t("div",{class:"section-header"},[t("h2",null,"Profile Details"),t("p",{class:"section-subtitle"},"Update your personal information")],-1)),t("form",{onSubmit:o(Ee,["prevent"]),class:"profile-form"},[t("div",G,[a[48]||(a[48]=t("h3",null,"Personal Information",-1)),t("div",Z,[t("div",Y,[a[46]||(a[46]=t("label",null,"First Name",-1)),n(t("input",{"onUpdate:modelValue":a[12]||(a[12]=e=>ge.value.firstName=e),type:"text",placeholder:"Enter your first name",required:""},null,512),[[i,ge.value.firstName]])]),t("div",K,[a[47]||(a[47]=t("label",null,"Last Name",-1)),n(t("input",{"onUpdate:modelValue":a[13]||(a[13]=e=>ge.value.lastName=e),type:"text",placeholder:"Enter your last name",required:""},null,512),[[i,ge.value.lastName]])])])]),t("div",Q,[a[52]||(a[52]=t("h3",null,"Contact Information",-1)),t("div",ee,[a[49]||(a[49]=t("label",null,"Email Address",-1)),n(t("input",{"onUpdate:modelValue":a[14]||(a[14]=e=>ge.value.email=e),type:"email",placeholder:"Enter your email",required:"",disabled:""},null,512),[[i,ge.value.email]]),a[50]||(a[50]=t("small",{class:"field-note"},"Email cannot be changed",-1))]),t("div",ae,[a[51]||(a[51]=t("label",null,"Mobile Phone",-1)),n(t("input",{"onUpdate:modelValue":a[15]||(a[15]=e=>ge.value.phone=e),type:"tel",placeholder:"Enter your phone number"},null,512),[[i,ge.value.phone]])])]),t("div",se,[a[57]||(a[57]=t("h3",null,"Address Information",-1)),t("div",te,[a[53]||(a[53]=t("label",null,"Address",-1)),n(t("input",{"onUpdate:modelValue":a[16]||(a[16]=e=>ge.value.address=e),type:"text",placeholder:"Enter your address"},null,512),[[i,ge.value.address]])]),t("div",le,[t("div",oe,[a[54]||(a[54]=t("label",null,"City",-1)),n(t("input",{"onUpdate:modelValue":a[17]||(a[17]=e=>ge.value.city=e),type:"text",placeholder:"Enter your city"},null,512),[[i,ge.value.city]])]),t("div",ne,[a[55]||(a[55]=t("label",null,"Country",-1)),n(t("input",{"onUpdate:modelValue":a[18]||(a[18]=e=>ge.value.country=e),type:"text",placeholder:"Enter your country"},null,512),[[i,ge.value.country]])])]),t("div",ie,[a[56]||(a[56]=t("label",null,"ZIP Code",-1)),n(t("input",{"onUpdate:modelValue":a[19]||(a[19]=e=>ge.value.zip_code=e),type:"text",placeholder:"Enter your ZIP code"},null,512),[[i,ge.value.zip_code]])])]),a[58]||(a[58]=t("div",{class:"form-actions"},[t("button",{class:"btn btn-primary",type:"submit"},[t("i",{class:"btn-icon"},"💾"),c(" Save Changes ")])],-1))],32)])):l("",!0),"password"===he.value?(v(),s("section",re,[a[65]||(a[65]=t("div",{class:"section-header"},[t("h2",null,"Change Password"),t("p",{class:"section-subtitle"},"Update your account password")],-1)),t("form",{onSubmit:o(Te,["prevent"]),class:"password-form"},[t("div",ue,[a[60]||(a[60]=t("label",null,"Current Password",-1)),n(t("input",{"onUpdate:modelValue":a[20]||(a[20]=e=>be.value=e),type:"password",placeholder:"Enter your current password",required:""},null,512),[[i,be.value]])]),t("div",ce,[a[61]||(a[61]=t("label",null,"New Password",-1)),n(t("input",{"onUpdate:modelValue":a[21]||(a[21]=e=>we.value=e),type:"password",placeholder:"Enter your new password",required:""},null,512),[[i,we.value]]),a[62]||(a[62]=t("small",{class:"field-note"},"Password must be at least 6 characters",-1))]),t("div",de,[a[63]||(a[63]=t("label",null,"Confirm New Password",-1)),n(t("input",{"onUpdate:modelValue":a[22]||(a[22]=e=>Ce.value=e),type:"password",placeholder:"Confirm your new password",required:""},null,512),[[i,Ce.value]])]),a[64]||(a[64]=t("div",{class:"form-actions"},[t("button",{class:"btn btn-primary",type:"submit"},[t("i",{class:"btn-icon"},"🔒"),c(" Change Password ")])],-1)),Pe.value?(v(),s("div",{key:0,class:u(["message",Ne.value?"success":"error"])},[t("i",{class:u(Ne.value?"✅":"❌")},null,2),c(" "+r(Pe.value),1)],2)):l("",!0)],32)])):l("",!0)])])):(v(),s("div",h,[t("div",f,[a[24]||(a[24]=t("h2",null,"Customer Login",-1)),t("form",{onSubmit:o(_e,["prevent"])},[n(t("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>ve.value=e),type:"email",placeholder:"E-mail",required:""},null,512),[[i,ve.value]]),n(t("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>me.value=e),type:"password",placeholder:"Password",required:""},null,512),[[i,me.value]]),t("div",g,[t("a",{href:"#",onClick:a[2]||(a[2]=o(e=>ke.value=!0,["prevent"]))},"Forgot Password?")]),a[23]||(a[23]=t("button",{class:"btn btn-primary login-btn",type:"submit"},"Login",-1)),t("button",{class:"btn btn-secondary signup-btn",type:"button",style:{"margin-top":"10px"},onClick:a[3]||(a[3]=a=>e.$router.push("/signup"))},"Sign Up")],32),ye.value?(v(),s("div",b,r(ye.value),1)):l("",!0)]),ke.value?(v(),s("div",{key:0,class:"modal-overlay",onClick:a[7]||(a[7]=e=>ke.value=!1)},[t("div",{class:"modal-content",onClick:a[6]||(a[6]=o(()=>{},["stop"]))},[t("div",w,[a[25]||(a[25]=t("h3",null,"Reset Password",-1)),t("button",{class:"close-btn",onClick:a[4]||(a[4]=e=>ke.value=!1)},"×")]),t("form",{onSubmit:o(Me,["prevent"]),class:"reset-form"},[t("div",C,[a[26]||(a[26]=t("label",null,"Email Address",-1)),n(t("input",{"onUpdate:modelValue":a[5]||(a[5]=e=>Se.value=e),type:"email",placeholder:"Enter your email address",required:""},null,512),[[i,Se.value]])]),t("button",{class:"btn btn-primary",type:"submit",disabled:Ue.value},r(Ue.value?"Sending...":"Send Reset Link"),9,P),je.value?(v(),s("div",{key:0,class:u(["message",Ae.value?"success":"error"])},r(je.value),3)):l("",!0)],32)])])):l("",!0)]))]))}},[["__scopeId","data-v-3b64d60a"]]);export{pe as default};
