import{r as e,c as a,o as t,w as o,k as l,l as n,m as s,j as r,v as i,q as u,F as d,I as c,Y as p,_ as m,L as v,x as f,aq as y,u as h,O as g,Z as b,t as k}from"./vendor-C-dIp69U.js";import{u as x}from"./selectedTour-Ck3SDUbb.js";import{B as _}from"./Breadcrumb-CdrjXgk0.js";import{_ as w}from"./index-Dmf9SOn9.js";/* empty css                                                                   */import"./swiper-WOzPqNul.js";var C,S="https://js.stripe.com",P="".concat(S,"/").concat("basil","/stripe.js"),j=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,q=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/,T=function(e){return j.test(e)||q.test(e)},N=function(e){var a=document.createElement("script");a.src="".concat(P).concat("");var t=document.head||document.body;if(!t)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return t.appendChild(a),a},U=null,I=null,E=null,L=function(e){return null!==U?U:(U=new Promise(function(a,t){if("undefined"!=typeof window&&"undefined"!=typeof document)if(window.Stripe)a(window.Stripe);else try{var o=function(){for(var e=document.querySelectorAll('script[src^="'.concat(S,'"]')),a=0;a<e.length;a++){var t=e[a];if(T(t.src))return t}return null}();if(o&&e);else if(o){if(o&&null!==E&&null!==I){var l;o.removeEventListener("load",E),o.removeEventListener("error",I),null===(l=o.parentNode)||void 0===l||l.removeChild(o),o=N()}}else o=N();E=function(e,a){return function(){window.Stripe?e(window.Stripe):a(new Error("Stripe.js not available"))}}(a,t),I=function(e){return function(a){e(new Error("Failed to load Stripe.js",{cause:a}))}}(t),o.addEventListener("load",E),o.addEventListener("error",I)}catch(n){return void t(n)}else a(null)})).catch(function(e){return U=null,Promise.reject(e)})};Promise.resolve().then(function(){return C||(C=L(null).catch(function(e){return C=null,Promise.reject(e)}))}).catch(function(e){});const D={class:"checkout-main-layout"},R={class:"checkout-left"},B={class:"container"},O={class:"form-group"},$={class:"form-group"},J={class:"form-group"},V=["value"],A={class:"form-group phone-row"},F={class:"phone-input-group"},z={class:"country-code-display"},H=["src","alt"],M=["placeholder"],Y={class:"form-group"},G={class:"form-group"},Q={style:{display:"flex",gap:"8px"}},K={key:0},W=["href"],X={class:"cancellation-policy-section"},Z={class:"policy-checkbox-label"},ee={class:"policy-text"},ae=["disabled"],te={class:"form-group"},oe=["disabled"],le={key:0},ne={key:1},se={key:0,class:"success-message"},re={key:1,class:"error-message"},ie={class:"checkout-right"},ue={key:0,class:"order-summary-panel"},de={key:0,class:"order-summary-product"},ce=["src","alt"],pe={class:"order-summary-product-info"},me={class:"product-title"},ve={class:"product-detail"},fe={key:0,class:"product-detail"},ye={class:"product-detail"},he={key:1,class:"product-detail"},ge={key:2,class:"product-detail"},be=["href"],ke={key:1,class:"order-summary-product"},xe={class:"order-summary-product-info"},_e={class:"product-title"},we={class:"product-detail"},Ce={key:0,class:"product-detail"},Se={class:"product-detail"},Pe={key:1,class:"product-detail"},je={key:2,class:"product-detail"},qe={class:"order-summary-total-row"},Te={class:"order-summary-total"},Ne={class:"modal-header"},Ue={class:"modal-footer"},Ie=w({__name:"CheckoutView",setup(w){var C,S;let P,j,q;const T=b(),N=x(),U=[{name:"Turkey",code:"+90",iso:"TR"},{name:"United States",code:"+1",iso:"US"},{name:"Germany",code:"+49",iso:"DE"},{name:"France",code:"+33",iso:"FR"},{name:"United Kingdom",code:"+44",iso:"GB"},{name:"Italy",code:"+39",iso:"IT"},{name:"Spain",code:"+34",iso:"ES"},{name:"Netherlands",code:"+31",iso:"NL"},{name:"Russia",code:"+7",iso:"RU"},{name:"Japan",code:"+81",iso:"JP"},{name:"China",code:"+86",iso:"CN"},{name:"India",code:"+91",iso:"IN"},{name:"Brazil",code:"+55",iso:"BR"},{name:"Canada",code:"+1",iso:"CA"},{name:"Australia",code:"+61",iso:"AU"}],I=e(U[0].name),E=e(""),L=a(()=>U.find(e=>e.name===I.value)||U[0]),Ie=e(""),Ee=e((null==(C=N.tour)?void 0:C.email)||(null==(S=N.pass)?void 0:S.email)||""),Le=e(null);try{const e=localStorage.getItem("customerLogin");e&&(Le.value=JSON.parse(e))}catch(Xe){Le.value=null}const De=e(""),Re=e(!1),Be=e(!1),Oe=e(""),$e=e(1),Je=e(""),Ve=e(""),Ae=e(!1),Fe=e(!1),ze=e(localStorage.getItem("selectedCurrency")||"EUR"),He=a(()=>({EUR:4,USD:5,GBP:6,TRY:7}[ze.value]||4)),Me=a(()=>({tr:2,de:6,en:1,ar:3,es:4,fr:5,it:7,pt:8,zh:10,ja:11,ru:9}[localStorage.getItem("selectedLanguage")||"en"]||1));function Ye(){q||(P=window.Stripe("pk_test_51RmaYhQQzUg4uq68XfoINf2CrffnJsjaJ1OHLwLtNLHHKcJ2uPlQABvQi5gFefQ5CnyJtbBbLOK7yioo2pPhkzfS00bUBXgBV7"),j=P.elements(),q=j.create("card",{style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"}},invalid:{color:"#9e2146"}}}),q.mount("#card-element"))}function Ge(){navigator.geolocation?navigator.geolocation.getCurrentPosition(async e=>{const{latitude:a,longitude:t}=e.coords;try{const e=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${a}&lon=${t}`),o=await e.json();Ve.value=o.display_name||`${a}, ${t}`}catch(o){Ve.value=`${a}, ${t}`}},e=>{alert("Could not get your location")}):alert("Geolocation is not supported by your browser")}function Qe(e){if(/^-?\d+(\.\d+)?[, ]+\s*-?\d+(\.\d+)?$/.test(e)){const a=e.split(/[ ,]+/).map(Number);return`https://www.google.com/maps?q=${a[0]},${a[1]}`}return`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(e)}`}function Ke(e){if(!e)return 0;const a=e.replace(/[^\d.,]/g,"").replace(",","."),t=parseFloat(a);return Math.round(100*t)}t(()=>{o($e,e=>{2===e&&setTimeout(()=>{if(window.Stripe)Ye();else{const e=document.createElement("script");e.src="https://js.stripe.com/v3/",e.onload=Ye,document.head.appendChild(e)}},0)},{immediate:!0})});const We=async()=>{var e,a,t,o,l,n,s,r,i,u,d,c,p,m,v,f,y,h,g,b,k,x;if(1===$e.value)return Ie.value&&Ee.value&&I.value&&E.value?Ae.value?void($e.value=2):void(Oe.value="Please accept the cancellation policy to continue."):void(Oe.value="Please fill in all required fields.");Re.value=!0,Oe.value="",Be.value=!1;try{if(!P)throw new Error("Stripe not initialized. Please refresh the page.");const w=await fetch("https://backend.searchyourtour.com/api/submit-booking",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customer:{name:Ie.value,email:Ee.value,phone:L.value.code+E.value,country:I.value,hotel_address:Je.value,user_location:Ve.value,confirm:!0},...N.tour?{tour:{id:(null==(e=N.tour)?void 0:e.id)||null,title:(null==(a=N.tour)?void 0:a.title)||"",description:(null==(t=N.tour)?void 0:t.description)||"",price:(null==(o=N.tour)?void 0:o.price)||"",booking_date:(null==(l=N.tour)?void 0:l.bookingDate)||(new Date).toISOString().split("T")[0],tenant_id:"ad5257a5-efdd-4314-9e5e-b56aabe321f1",currency_id:He.value,language_id:Me.value,buggy:0,adult:(null==(n=N.tour)?void 0:n.adult)||1,child:(null==(s=N.tour)?void 0:s.child)||0,infant:(null==(r=N.tour)?void 0:r.infant)||0,roomNumber:0,randomCode:Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),type:"tour",customer_id:(null==(i=Le.value)?void 0:i.id)||0}}:{pass:{id:(null==(u=N.pass)?void 0:u.id)||null,name:(null==(d=N.pass)?void 0:d.name)||"",days:(null==(c=N.pass)?void 0:c.days)||1,price:(null==(p=N.pass)?void 0:p.price)||"",total_price:(null==(m=N.pass)?void 0:m.totalPrice)||"",quantity:(null==(v=N.pass)?void 0:v.quantity)||1,start_date:(null==(f=N.pass)?void 0:f.startDate)||(new Date).toISOString().split("T")[0],email:(null==(y=N.pass)?void 0:y.email)||"",tenant_id:"ad5257a5-efdd-4314-9e5e-b56aabe321f1",currency_id:He.value,language_id:Me.value,randomCode:Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),type:"pass"}},payment:{amount:Ke((null==(h=N.tour)?void 0:h.price)||(null==(g=N.pass)?void 0:g.totalPrice)||""),currency:ze.value}})}),C=await w.json();if(null==C?void 0:C.client_secret){const e=await P.confirmCardPayment(C.client_secret,{payment_method:{card:q,billing_details:{name:Ie.value,email:Ee.value,phone:L.value.code+E.value,address:{country:L.value.iso,line1:Je.value}}},return_url:"https://yourfrontend.com/payment-status"});try{const a=C.payment_intent_id;e.error?(Oe.value=e.error.message||"Payment failed. Please try again.",C.reservation_id&&a&&await fetch("https://backend.searchyourtour.com/api/check_payment_status",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reservation_id:C.reservation_id,randomCode:C.randomCode,payment_intent_id:a})})):"succeeded"===e.paymentIntent.status?(Be.value=!0,C.reservation_id&&a&&await fetch("https://backend.searchyourtour.com/api/check_payment_status",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reservation_id:C.reservation_id,randomCode:C.randomCode,payment_intent_id:a})}),T.push({name:"payment-success",query:{bookingId:C.reservation_id,tourTitle:(null==(b=N.tour)?void 0:b.title)||"",bookingDate:(null==(k=N.tour)?void 0:k.bookingDate)||"",amount:(null==(x=N.tour)?void 0:x.price)||"",customerName:Ie.value||""}})):(Oe.value="Ã–deme iÅŸlemi tamamlanmadÄ±, ek onay gerekebilir.",C.reservation_id&&a&&await fetch("https://backend.searchyourtour.com/api/check_payment_status",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reservation_id:C.reservation_id,randomCode:C.randomCode,payment_intent_id:a})}))}catch(_){Oe.value=_.message||"Payment failed. Please try again."}finally{Re.value=!1}}}catch(_){Oe.value=_.message||"Payment failed. Please try again."}finally{Re.value=!1}};return(e,a)=>{var t,o;return k(),l("div",D,[n("div",R,[n("div",B,[r(_)]),a[26]||(a[26]=n("h2",null,"Enter your personal details",-1)),a[27]||(a[27]=n("div",{class:"secure-checkout"},[n("i",{class:"fas fa-lock"}),i(" Checkout is fast and secure ")],-1)),n("form",{onSubmit:u(We,["prevent"]),class:"checkout-form"},[1===$e.value?(k(),l(d,{key:0},[n("div",O,[a[13]||(a[13]=n("label",null,[i("Full name "),n("span",{class:"required"},"*")],-1)),c(n("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>Ie.value=e),type:"text",required:"",placeholder:"Full Name"},null,512),[[p,Ie.value]])]),n("div",$,[a[14]||(a[14]=n("label",null,[i("Email "),n("span",{class:"required"},"*")],-1)),c(n("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>Ee.value=e),type:"email",required:"",placeholder:"you@email.com"},null,512),[[p,Ee.value]])]),n("div",J,[a[15]||(a[15]=n("label",null,[i("Country "),n("span",{class:"required"},"*")],-1)),c(n("select",{"onUpdate:modelValue":a[2]||(a[2]=e=>I.value=e),class:"country-select-fullwidth"},[(k(),l(d,null,v(U,e=>n("option",{key:e.iso,value:e.name},f(e.name),9,V)),64))],512),[[m,I.value]])]),n("div",A,[a[16]||(a[16]=n("label",null,[i("Mobile phone number "),n("span",{class:"required"},"*")],-1)),n("div",F,[n("div",z,[n("img",{src:`https://flagsapi.com/${L.value.iso}/flat/24.png`,alt:L.value.name,class:"flag-option"},null,8,H),n("span",null,f(L.value.code),1)]),c(n("input",{"onUpdate:modelValue":a[3]||(a[3]=e=>E.value=e),type:"tel",required:"",class:"phone-input",placeholder:"TR"===L.value.iso?"5xx xxx xx xx":"US"===L.value.iso?"xxx xxx xxxx":"DE"===L.value.iso?"1xx xxxxxxx":"xx xx xx xx"},null,8,M),[[p,E.value]])])]),n("div",Y,[a[17]||(a[17]=n("label",null,"Hotel Address (optional)",-1)),c(n("input",{"onUpdate:modelValue":a[4]||(a[4]=e=>Je.value=e),type:"text",placeholder:"Enter your hotel address"},null,512),[[p,Je.value]])]),n("div",G,[a[18]||(a[18]=n("label",null,"Your Location (optional)",-1)),n("div",Q,[c(n("input",{"onUpdate:modelValue":a[5]||(a[5]=e=>Ve.value=e),type:"text",placeholder:"Click the button to add your current location",readonly:"",class:"input",style:{flex:"1"}},null,512),[[p,Ve.value]]),n("button",{type:"button",onClick:Ge,class:"location-btn",title:"Use my location"},"ðŸ“")]),Ve.value?(k(),l("div",K,[n("a",{href:Qe(Ve.value),target:"_blank",rel:"noopener",style:{color:"#0070eb","text-decoration":"underline",cursor:"pointer","font-size":"0.97em"}}," View on Google Maps ",8,W)])):s("",!0)]),a[21]||(a[21]=n("div",{class:"form-note"},"We'll only contact you with essential updates or changes to your booking",-1)),n("div",X,[n("label",Z,[c(n("input",{"onUpdate:modelValue":a[6]||(a[6]=e=>Ae.value=e),type:"checkbox",class:"policy-checkbox",required:""},null,512),[[y,Ae.value]]),a[20]||(a[20]=n("span",{class:"checkbox-custom"},null,-1)),n("span",ee,[a[19]||(a[19]=i(" I have read and accept the ")),n("button",{type:"button",onClick:a[7]||(a[7]=e=>Fe.value=!0),class:"policy-link"}," Cancellation Policy ")])])]),n("button",{class:"pay-btn",type:"submit",disabled:!Ae.value},"Go to payment",8,ae)],64)):(k(),l(d,{key:1},[n("div",te,[a[22]||(a[22]=n("label",null,[i("Name on Card "),n("span",{class:"required"},"*")],-1)),c(n("input",{"onUpdate:modelValue":a[8]||(a[8]=e=>De.value=e),type:"text",required:"",placeholder:"Name on Card"},null,512),[[p,De.value]])]),a[25]||(a[25]=n("div",{class:"form-group"},[n("label",null,"Card Details"),n("div",{id:"card-element",class:"stripe-card-element"})],-1)),n("button",{class:"pay-btn",disabled:Re.value,type:"submit"},[Re.value?(k(),l("span",le,"Processing...")):(k(),l("span",ne,"Pay Now"))],8,oe),Be.value?(k(),l("div",se,a[23]||(a[23]=[n("i",{class:"fas fa-check-circle"},null,-1),n("div",null,[n("strong",null,"Payment Successful!"),n("p",null,"Your booking has been confirmed. You will receive a confirmation email shortly.")],-1)]))):s("",!0),Oe.value?(k(),l("div",re,[a[24]||(a[24]=n("i",{class:"fas fa-exclamation-circle"},null,-1)),i(" "+f(Oe.value),1)])):s("",!0)],64))],32)]),n("div",ie,[h(N).tour||h(N).pass?(k(),l("div",ue,[a[38]||(a[38]=n("div",{class:"order-summary-title"},"Order summary",-1)),h(N).tour?(k(),l("div",de,[n("img",{class:"order-summary-img",src:h(N).tour.image,alt:h(N).tour.title},null,8,ce),n("div",pe,[n("div",me,f(h(N).tour.title),1),n("div",ve,f(h(N).tour.description),1),h(N).tour.bookingDate?(k(),l("div",fe,[a[28]||(a[28]=n("i",{class:"fas fa-calendar-alt"},null,-1)),i(" "+f(h(N).tour.bookingDate),1)])):s("",!0),n("div",ye,[a[29]||(a[29]=n("i",{class:"fas fa-user"},null,-1)),i(" "+f(h(N).tour.participants),1)]),h(N).tour.email?(k(),l("div",he,[a[30]||(a[30]=n("i",{class:"fas fa-envelope"},null,-1)),i(" "+f(h(N).tour.email),1)])):s("",!0),h(N).tour.userLocation?(k(),l("div",ge,[a[31]||(a[31]=n("i",{class:"fas fa-map-marker-alt"},null,-1)),n("a",{href:Qe(h(N).tour.userLocation),target:"_blank",rel:"noopener",style:{color:"#0070eb","text-decoration":"underline",cursor:"pointer"}},f(h(N).tour.userLocation),9,be)])):s("",!0)])])):s("",!0),h(N).pass?(k(),l("div",ke,[a[36]||(a[36]=n("div",{class:"pass-icon"},[n("i",{class:"fas fa-ticket-alt"})],-1)),n("div",xe,[n("div",_e,f(h(N).pass.name),1),n("div",we,f(h(N).pass.days)+" Day Istanbul Tourist Pass",1),h(N).pass.startDate?(k(),l("div",Ce,[a[32]||(a[32]=n("i",{class:"fas fa-calendar-alt"},null,-1)),i(" Start Date: "+f(h(N).pass.startDate),1)])):s("",!0),n("div",Se,[a[33]||(a[33]=n("i",{class:"fas fa-user"},null,-1)),i(" Quantity: "+f(h(N).pass.quantity),1)]),h(N).pass.email?(k(),l("div",Pe,[a[34]||(a[34]=n("i",{class:"fas fa-envelope"},null,-1)),i(" "+f(h(N).pass.email),1)])):s("",!0),h(N).pass.discount?(k(),l("div",je,[a[35]||(a[35]=n("i",{class:"fas fa-tag"},null,-1)),i(" Save "+f(h(N).pass.discount)+"â‚¬ ",1)])):s("",!0)])])):s("",!0),n("div",qe,[a[37]||(a[37]=n("span",null,"Total",-1)),n("span",Te,f((null==(t=h(N).tour)?void 0:t.price)||(null==(o=h(N).pass)?void 0:o.totalPrice)),1)]),a[39]||(a[39]=n("div",{class:"order-summary-taxes"},"All taxes and fees included",-1))])):s("",!0)]),Fe.value?(k(),l("div",{key:0,class:"modal-overlay",onClick:a[12]||(a[12]=e=>Fe.value=!1)},[n("div",{class:"modal-content",onClick:a[11]||(a[11]=u(()=>{},["stop"]))},[n("div",Ne,[a[40]||(a[40]=n("h3",null,"Cancellation Policy Agreement",-1)),n("button",{onClick:a[9]||(a[9]=e=>Fe.value=!1),class:"modal-close"},"Ã—")]),a[41]||(a[41]=g('<div class="modal-body" data-v-fa822682><div class="policy-content" data-v-fa822682><h4 data-v-fa822682>Introduction</h4><p data-v-fa822682>We aim to make your travel experience flexible and stress-free. By completing a booking, you agree to the following cancellation and refund terms:</p><h4 data-v-fa822682>1. Free Cancellation up to 24 Hours Before the Tour</h4><p data-v-fa822682>You may cancel your booking up to 24 hours before the scheduled start time and receive a full refund.</p><h4 data-v-fa822682>2. Cancellation Less Than 24 Hours</h4><p data-v-fa822682>Cancellations made less than 24 hours before the tour start time are non-refundable.</p><h4 data-v-fa822682>3. No-Show</h4><p data-v-fa822682>If you fail to appear at the designated meeting point and time, no refund will be issued.</p><h4 data-v-fa822682>4. Rescheduling</h4><p data-v-fa822682>Subject to availability and provider conditions, you may reschedule your tour without additional fees.</p><h4 data-v-fa822682>5. Cancellations by the Provider</h4><p data-v-fa822682>In rare cases where the tour is canceled by the provider due to unforeseen circumstances (such as weather conditions or operational issues), you will be offered either a full refund or the option to reschedule.</p><h4 data-v-fa822682>6. How to Cancel / Request a Refund</h4><p data-v-fa822682>To cancel your booking or request a refund, you must contact us by email at: <strong data-v-fa822682>info@searchyourtour.com</strong></p><p data-v-fa822682>When sending your request, include the following details:</p><ul data-v-fa822682><li data-v-fa822682>Booking reference number</li><li data-v-fa822682>Name on the reservation</li><li data-v-fa822682>Tour date</li><li data-v-fa822682>Reason for cancellation</li></ul><p data-v-fa822682>Refunds will be processed to the original payment method after your request has been verified.</p><h4 data-v-fa822682>Acceptance</h4><p data-v-fa822682>By completing the booking, you confirm that you have read and accepted this Cancellation Policy Agreement.</p></div></div>',1)),n("div",Ue,[n("button",{onClick:a[10]||(a[10]=e=>Fe.value=!1),class:"modal-close-btn"},"Close")])])])):s("",!0)])}}},[["__scopeId","data-v-fa822682"]]);export{Ie as default};
